// set the attribute to true or leave empty, true without any quotes.
// if the generated adoc file is used outside tabs, it renders correctly depending on the attribute set.
// if inside, you need to also use the xxx_deprecation.adoc file. attributes can't be defined inside tabs.

:show-deprecation: false

ifeval::[{show-deprecation} == true]

[#deprecation-note-2024-09-13-09-06-37]
[caption=]
.Deprecation notes for the storage-users service
[width="100%",cols="~,~,~,~",options="header"]
|===
| Deprecation Info
| Deprecation Version
| Removal Version
| Deprecation Replacement
|===

{empty} +

endif::[]

[caption=]
.Environment variables for the storage-users service
[width="100%",cols="~,~,~,~,~",options="header"]
|===
| Name
| IV
| Type
| Default Value
| Description

a|`STORAGE_USERS_SERVICE_NAME` +

a| [subs=-attributes]
++next ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++storage-users ++
a| [subs=-attributes]
Service name to use. Change this when starting an additional storage provider with a custom configuration to prevent it from colliding with the default 'storage-users' service.

a|`OCIS_TRACING_ENABLED` +
`STORAGE_USERS_TRACING_ENABLED` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Activates tracing.

a|`OCIS_TRACING_TYPE` +
`STORAGE_USERS_TRACING_TYPE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The type of tracing. Defaults to '', which is the same as 'jaeger'. Allowed tracing types are 'jaeger' and '' as of now.

a|`OCIS_TRACING_ENDPOINT` +
`STORAGE_USERS_TRACING_ENDPOINT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The endpoint of the tracing agent.

a|`OCIS_TRACING_COLLECTOR` +
`STORAGE_USERS_TRACING_COLLECTOR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The HTTP endpoint for sending spans directly to a collector, i.e. \http://jaeger-collector:14268/api/traces. Only used if the tracing endpoint is unset.

a|`OCIS_LOG_LEVEL` +
`STORAGE_USERS_LOG_LEVEL` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The log level. Valid values are: 'panic', 'fatal', 'error', 'warn', 'info', 'debug', 'trace'.

a|`OCIS_LOG_PRETTY` +
`STORAGE_USERS_LOG_PRETTY` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Activates pretty log output.

a|`OCIS_LOG_COLOR` +
`STORAGE_USERS_LOG_COLOR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Activates colorized log output.

a|`OCIS_LOG_FILE` +
`STORAGE_USERS_LOG_FILE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The path to the log file. Activates logging to this file if set.

a|`STORAGE_USERS_DEBUG_ADDR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++127.0.0.1:9159 ++
a| [subs=-attributes]
Bind address of the debug server, where metrics, health, config and debug endpoints will be exposed.

a|`STORAGE_USERS_DEBUG_TOKEN` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Token to secure the metrics endpoint.

a|`STORAGE_USERS_DEBUG_PPROF` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Enables pprof, which can be used for profiling.

a|`STORAGE_USERS_DEBUG_ZPAGES` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Enables zpages, which can be used for collecting and viewing in-memory traces.

a|`STORAGE_USERS_GRPC_ADDR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++127.0.0.1:9157 ++
a| [subs=-attributes]
The bind address of the GRPC service.

a|`OCIS_GRPC_PROTOCOL` +
`STORAGE_USERS_GRPC_PROTOCOL` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++tcp ++
a| [subs=-attributes]
The transport protocol of the GPRC service.

a|`STORAGE_USERS_HTTP_ADDR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++127.0.0.1:9158 ++
a| [subs=-attributes]
The bind address of the HTTP service.

a|`STORAGE_USERS_HTTP_PROTOCOL` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++tcp ++
a| [subs=-attributes]
The transport protocol of the HTTP service.

a|`OCIS_CORS_ALLOW_ORIGINS` +
`STORAGE_USERS_CORS_ALLOW_ORIGINS` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++[]string ++
a| [subs=-attributes]
++[https://localhost:9200] ++
a| [subs=-attributes]
A list of allowed CORS origins. See following chapter for more details: *Access-Control-Allow-Origin* at \https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin. See the Environment Variable Types description for more details.

a|`OCIS_CORS_ALLOW_METHODS` +
`STORAGE_USERS_CORS_ALLOW_METHODS` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++[]string ++
a| [subs=-attributes]
++[POST HEAD PATCH OPTIONS GET DELETE] ++
a| [subs=-attributes]
A list of allowed CORS methods. See following chapter for more details: *Access-Control-Request-Method* at \https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Request-Method. See the Environment Variable Types description for more details.

a|`OCIS_CORS_ALLOW_HEADERS` +
`STORAGE_USERS_CORS_ALLOW_HEADERS` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++[]string ++
a| [subs=-attributes]
++[Authorization Origin X-Requested-With X-Request-Id X-HTTP-Method-Override Content-Type Upload-Length Upload-Offset Tus-Resumable Upload-Metadata Upload-Defer-Length Upload-Concat Upload-Incomplete Upload-Draft-Interop-Version] ++
a| [subs=-attributes]
A list of allowed CORS headers. See following chapter for more details: *Access-Control-Request-Headers* at \https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Request-Headers. See the Environment Variable Types description for more details.

a|`OCIS_CORS_ALLOW_CREDENTIALS` +
`STORAGE_USERS_CORS_ALLOW_CREDENTIALS` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Allow credentials for CORS.See following chapter for more details: *Access-Control-Allow-Credentials* at \https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials.

a|`OCIS_CORS_EXPOSE_HEADERS` +
`STORAGE_USERS_CORS_EXPOSE_HEADERS` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++[]string ++
a| [subs=-attributes]
++[Upload-Offset Location Upload-Length Tus-Version Tus-Resumable Tus-Max-Size Tus-Extension Upload-Metadata Upload-Defer-Length Upload-Concat Upload-Incomplete Upload-Draft-Interop-Version] ++
a| [subs=-attributes]
A list of exposed CORS headers. See following chapter for more details: *Access-Control-Expose-Headers* at \https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Expose-Headers. See the Environment Variable Types description for more details.

a|`OCIS_CORS_MAX_AGE` +
`STORAGE_USERS_CORS_MAX_AGE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++uint ++
a| [subs=-attributes]
++86400 ++
a| [subs=-attributes]
The max cache duration of preflight headers. See following chapter for more details: *Access-Control-Max-Age* at \https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Max-Age. See the Environment Variable Types description for more details.

a|`OCIS_JWT_SECRET` +
`STORAGE_USERS_JWT_SECRET` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The secret to mint and validate jwt tokens.

a|`OCIS_REVA_GATEWAY` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++com.owncloud.api.gateway ++
a| [subs=-attributes]
The CS3 gateway endpoint.

a|`OCIS_GRPC_CLIENT_TLS_MODE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
TLS mode for grpc connection to the go-micro based grpc services. Possible values are 'off', 'insecure' and 'on'. 'off': disables transport security for the clients. 'insecure' allows using transport security, but disables certificate verification (to be used with the autogenerated self-signed certificates). 'on' enables transport security, including server certificate verification.

a|`OCIS_GRPC_CLIENT_TLS_CACERT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Path/File name for the root CA certificate (in PEM format) used to validate TLS server certificates of the go-micro based grpc services.

a|`STORAGE_USERS_SKIP_USER_GROUPS_IN_TOKEN` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Disables the loading of user's group memberships from the reva access token.

a|`STORAGE_USERS_GRACEFUL_SHUTDOWN_TIMEOUT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++30 ++
a| [subs=-attributes]
The number of seconds to wait for the 'storage-users' service to shutdown cleanly before exiting with an error that gets logged. Note: This setting is only applicable when running the 'storage-users' service as a standalone service. See the text description for more details.

a|`STORAGE_USERS_DRIVER` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ocis ++
a| [subs=-attributes]
The storage driver which should be used by the service. Defaults to 'ocis', Supported values are: 'ocis', 's3ng' and 'owncloudsql'. The 'ocis' driver stores all data (blob and meta data) in an POSIX compliant volume. The 's3ng' driver stores metadata in a POSIX compliant volume and uploads blobs to the s3 bucket.

a|`OCIS_DECOMPOSEDFS_METADATA_BACKEND` +
`STORAGE_USERS_OCIS_METADATA_BACKEND` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++messagepack ++
a| [subs=-attributes]
The backend to use for storing metadata. Supported values are 'messagepack' and 'xattrs'. The setting 'messagepack' uses a dedicated file to store file metadata while 'xattrs' uses extended attributes to store file metadata. Defaults to 'messagepack'.

a|`OCIS_DECOMPOSEDFS_PROPAGATOR` +
`STORAGE_USERS_OCIS_PROPAGATOR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++sync ++
a| [subs=-attributes]
The propagator used for decomposedfs. At the moment, only 'sync' is fully supported, 'async' is available as an experimental option.

a|`STORAGE_USERS_ASYNC_PROPAGATOR_PROPAGATION_DELAY` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++Duration ++
a| [subs=-attributes]
++0s ++
a| [subs=-attributes]
The delay between a change made to a tree and the propagation start on treesize and treetime. Multiple propagations are computed to a single one. See the Environment Variable Types description for more details.

a|`STORAGE_USERS_OCIS_ROOT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++/var/lib/ocis/storage/users ++
a| [subs=-attributes]
The directory where the filesystem storage will store blobs and metadata. If not defined, the root directory derives from $OCIS_BASE_DATA_PATH:/storage/users.

a|`STORAGE_USERS_OCIS_USER_LAYOUT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++{{.Id.OpaqueId}} ++
a| [subs=-attributes]
Template string for the user storage layout in the user directory.

a|`STORAGE_USERS_PERMISSION_ENDPOINT` +
`STORAGE_USERS_OCIS_PERMISSIONS_ENDPOINT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++com.owncloud.api.settings ++
a| [subs=-attributes]
Endpoint of the permissions service. The endpoints can differ for 'ocis' and 's3ng'.

a|`STORAGE_USERS_OCIS_PERSONAL_SPACE_ALIAS_TEMPLATE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++{{.SpaceType}}/{{.User.Username \| lower}} ++
a| [subs=-attributes]
Template string to construct personal space aliases.

a|`STORAGE_USERS_OCIS_PERSONAL_SPACE_PATH_TEMPLATE` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Template string to construct the paths of the personal space roots.

a|`STORAGE_USERS_OCIS_GENERAL_SPACE_ALIAS_TEMPLATE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++{{.SpaceType}}/{{.SpaceName \| replace " " "-" \| lower}} ++
a| [subs=-attributes]
Template string to construct general space aliases.

a|`STORAGE_USERS_OCIS_GENERAL_SPACE_PATH_TEMPLATE` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Template string to construct the paths of the projects space roots.

a|`STORAGE_USERS_OCIS_SHARE_FOLDER` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++/Shares ++
a| [subs=-attributes]
Name of the folder jailing all shares.

a|`STORAGE_USERS_OCIS_MAX_ACQUIRE_LOCK_CYCLES` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++20 ++
a| [subs=-attributes]
When trying to lock files, ocis will try this amount of times to acquire the lock before failing. After each try it will wait for an increasing amount of time. Values of 0 or below will be ignored and the default value will be used.

a|`STORAGE_USERS_OCIS_LOCK_CYCLE_DURATION_FACTOR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++30 ++
a| [subs=-attributes]
When trying to lock files, ocis will multiply the cycle with this factor and use it as a millisecond timeout. Values of 0 or below will be ignored and the default value will be used.

a|`STORAGE_USERS_OCIS_MAX_CONCURRENCY` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++5 ++
a| [subs=-attributes]
Maximum number of concurrent go-routines. Higher values can potentially get work done faster but will also cause more load on the system. Values of 0 or below will be ignored and the default value will be used.

a|`OCIS_ASYNC_UPLOADS` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++true ++
a| [subs=-attributes]
Enable asynchronous file uploads.

a|`OCIS_SPACES_MAX_QUOTA` +
`STORAGE_USERS_OCIS_MAX_QUOTA` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++uint64 ++
a| [subs=-attributes]
++0 ++
a| [subs=-attributes]
Set a global max quota for spaces in bytes. A value of 0 equals unlimited. If not using the global OCIS_SPACES_MAX_QUOTA, you must define the FRONTEND_MAX_QUOTA in the frontend service.

a|`OCIS_DISABLE_VERSIONING` +

a| [subs=-attributes]
++next ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Disables versioning of files. When set to true, new uploads with the same filename will overwrite existing files instead of creating a new version.

a|`STORAGE_USERS_S3NG_METADATA_BACKEND` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++messagepack ++
a| [subs=-attributes]
The backend to use for storing metadata. Supported values are 'xattrs' and 'messagepack'. The setting 'xattrs' uses extended attributes to store file metadata while 'messagepack' uses a dedicated file to store file metadata. Defaults to 'xattrs'.

a|`OCIS_DECOMPOSEDFS_PROPAGATOR` +
`STORAGE_USERS_S3NG_PROPAGATOR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++sync ++
a| [subs=-attributes]
The propagator used for decomposedfs. At the moment, only 'sync' is fully supported, 'async' is available as an experimental option.

a|`STORAGE_USERS_ASYNC_PROPAGATOR_PROPAGATION_DELAY` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++Duration ++
a| [subs=-attributes]
++0s ++
a| [subs=-attributes]
The delay between a change made to a tree and the propagation start on treesize and treetime. Multiple propagations are computed to a single one. See the Environment Variable Types description for more details.

a|`STORAGE_USERS_S3NG_ROOT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++/var/lib/ocis/storage/users ++
a| [subs=-attributes]
The directory where the filesystem storage will store metadata for blobs. If not defined, the root directory derives from $OCIS_BASE_DATA_PATH:/storage/users.

a|`STORAGE_USERS_S3NG_USER_LAYOUT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++{{.Id.OpaqueId}} ++
a| [subs=-attributes]
Template string for the user storage layout in the user directory.

a|`STORAGE_USERS_PERMISSION_ENDPOINT` +
`STORAGE_USERS_S3NG_PERMISSIONS_ENDPOINT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++com.owncloud.api.settings ++
a| [subs=-attributes]
Endpoint of the permissions service. The endpoints can differ for 'ocis' and 's3ng'.

a|`STORAGE_USERS_S3NG_REGION` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++default ++
a| [subs=-attributes]
Region of the S3 bucket.

a|`STORAGE_USERS_S3NG_ACCESS_KEY` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Access key for the S3 bucket.

a|`STORAGE_USERS_S3NG_SECRET_KEY` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Secret key for the S3 bucket.

a|`STORAGE_USERS_S3NG_ENDPOINT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Endpoint for the S3 bucket.

a|`STORAGE_USERS_S3NG_BUCKET` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Name of the S3 bucket.

a|`STORAGE_USERS_S3NG_PUT_OBJECT_DISABLE_CONTENT_SHA256` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Disable sending content sha256 when copying objects to S3.

a|`STORAGE_USERS_S3NG_PUT_OBJECT_DISABLE_MULTIPART` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++true ++
a| [subs=-attributes]
Disable multipart uploads when copying objects to S3

a|`STORAGE_USERS_S3NG_PUT_OBJECT_SEND_CONTENT_MD5` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++true ++
a| [subs=-attributes]
Send a Content-MD5 header when copying objects to S3.

a|`STORAGE_USERS_S3NG_PUT_OBJECT_CONCURRENT_STREAM_PARTS` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++true ++
a| [subs=-attributes]
Always precreate parts when copying objects to S3.

a|`STORAGE_USERS_S3NG_PUT_OBJECT_NUM_THREADS` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++uint ++
a| [subs=-attributes]
++4 ++
a| [subs=-attributes]
Number of concurrent uploads to use when copying objects to S3.

a|`STORAGE_USERS_S3NG_PUT_OBJECT_PART_SIZE` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++uint64 ++
a| [subs=-attributes]
++0 ++
a| [subs=-attributes]
Part size for concurrent uploads to S3.

a|`STORAGE_USERS_S3NG_PERSONAL_SPACE_ALIAS_TEMPLATE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++{{.SpaceType}}/{{.User.Username \| lower}} ++
a| [subs=-attributes]
Template string to construct personal space aliases.

a|`STORAGE_USERS_S3NG_PERSONAL_SPACE_PATH_TEMPLATE` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Template string to construct the paths of the personal space roots.

a|`STORAGE_USERS_S3NG_GENERAL_SPACE_ALIAS_TEMPLATE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++{{.SpaceType}}/{{.SpaceName \| replace " " "-" \| lower}} ++
a| [subs=-attributes]
Template string to construct general space aliases.

a|`STORAGE_USERS_S3NG_GENERAL_SPACE_PATH_TEMPLATE` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Template string to construct the paths of the projects space roots.

a|`STORAGE_USERS_S3NG_SHARE_FOLDER` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++/Shares ++
a| [subs=-attributes]
Name of the folder jailing all shares.

a|`STORAGE_USERS_S3NG_MAX_ACQUIRE_LOCK_CYCLES` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++20 ++
a| [subs=-attributes]
When trying to lock files, ocis will try this amount of times to acquire the lock before failing. After each try it will wait for an increasing amount of time. Values of 0 or below will be ignored and the default value of 20 will be used.

a|`STORAGE_USERS_S3NG_LOCK_CYCLE_DURATION_FACTOR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++30 ++
a| [subs=-attributes]
When trying to lock files, ocis will multiply the cycle with this factor and use it as a millisecond timeout. Values of 0 or below will be ignored and the default value of 30 will be used.

a|`STORAGE_USERS_S3NG_MAX_CONCURRENCY` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++5 ++
a| [subs=-attributes]
Maximum number of concurrent go-routines. Higher values can potentially get work done faster but will also cause more load on the system. Values of 0 or below will be ignored and the default value of 100 will be used.

a|`OCIS_DISABLE_VERSIONING` +

a| [subs=-attributes]
++next ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Disables versioning of files. When set to true, new uploads with the same filename will overwrite existing files instead of creating a new version.

a|`STORAGE_USERS_OWNCLOUDSQL_DATADIR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++/var/lib/ocis/storage/owncloud ++
a| [subs=-attributes]
The directory where the filesystem storage will store SQL migration data. If not defined, the root directory derives from $OCIS_BASE_DATA_PATH:/storage/owncloud.

a|`STORAGE_USERS_OWNCLOUDSQL_SHARE_FOLDER` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++/Shares ++
a| [subs=-attributes]
Name of the folder jailing all shares.

a|`STORAGE_USERS_OWNCLOUDSQL_LAYOUT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++{{.Username}} ++
a| [subs=-attributes]
Path layout to use to navigate into a users folder in an owncloud data directory

a|`STORAGE_USERS_OWNCLOUDSQL_UPLOADINFO_DIR` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++/var/lib/ocis/storage/uploadinfo ++
a| [subs=-attributes]
The directory where the filesystem will store uploads temporarily. If not defined, the root directory derives from $OCIS_BASE_DATA_PATH:/storage/uploadinfo.

a|`STORAGE_USERS_OWNCLOUDSQL_DB_USERNAME` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++owncloud ++
a| [subs=-attributes]
Username for the database.

a|`STORAGE_USERS_OWNCLOUDSQL_DB_PASSWORD` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++owncloud ++
a| [subs=-attributes]
Password for the database.

a|`STORAGE_USERS_OWNCLOUDSQL_DB_HOST` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Hostname or IP of the database server.

a|`STORAGE_USERS_OWNCLOUDSQL_DB_PORT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++3306 ++
a| [subs=-attributes]
Port that the database server is listening on.

a|`STORAGE_USERS_OWNCLOUDSQL_DB_NAME` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++owncloud ++
a| [subs=-attributes]
Name of the database to be used.

a|`STORAGE_USERS_OWNCLOUDSQL_USERS_PROVIDER_ENDPOINT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++com.owncloud.api.users ++
a| [subs=-attributes]
Endpoint of the users provider.

a|`STORAGE_USERS_POSIX_ROOT` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The directory where the filesystem storage will store its data. If not defined, the root directory derives from $OCIS_BASE_DATA_PATH:/storage/owncloud.

a|`STORAGE_USERS_POSIX_PERSONAL_SPACE_PATH_TEMPLATE` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++users/{{.User.Username}} ++
a| [subs=-attributes]
Template string to construct the paths of the personal space roots.

a|`STORAGE_USERS_POSIX_GENERAL_SPACE_PATH_TEMPLATE` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++projects/{{.SpaceId}} ++
a| [subs=-attributes]
Template string to construct the paths of the projects space roots.

a|`STORAGE_USERS_PERMISSION_ENDPOINT` +
`STORAGE_USERS_POSIX_PERMISSIONS_ENDPOINT` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++com.owncloud.api.settings ++
a| [subs=-attributes]
Endpoint of the permissions service. The endpoints can differ for 'ocis', 'posix' and 's3ng'.

a|`OCIS_ASYNC_UPLOADS` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++true ++
a| [subs=-attributes]
Enable asynchronous file uploads.

a|`STORAGE_USERS_POSIX_USE_SPACE_GROUPS` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Use space groups to manage permissions on spaces.

a|`STORAGE_USERS_POSIX_WATCH_TYPE` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Type of the watcher to use for getting notified about changes to the filesystem. Currently available options are 'inotifywait' (default), 'gpfswatchfolder' and 'gpfsfileauditlogging'.

a|`STORAGE_USERS_POSIX_WATCH_PATH` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Path to the watch directory/file. Only applies to the 'gpfsfileauditlogging' and 'inotifywait' watcher, in which case it is the path of the file audit log file/base directory to watch.

a|`STORAGE_USERS_POSIX_WATCH_FOLDER_KAFKA_BROKERS` +

a| [subs=-attributes]
++6.0.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Comma-separated list of kafka brokers to read the watchfolder events from.

a|`STORAGE_USERS_DATA_SERVER_URL` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++http://localhost:9158/data ++
a| [subs=-attributes]
URL of the data server, needs to be reachable by the data gateway provided by the frontend service or the user if directly exposed.

a|`STORAGE_USERS_DATA_GATEWAY_URL` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++https://localhost:9200/data ++
a| [subs=-attributes]
URL of the data gateway server

a|`STORAGE_USERS_TRANSFER_EXPIRES` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int64 ++
a| [subs=-attributes]
++86400 ++
a| [subs=-attributes]
The time after which the token for upload postprocessing expires

a|`OCIS_EVENTS_ENDPOINT` +
`STORAGE_USERS_EVENTS_ENDPOINT` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++127.0.0.1:9233 ++
a| [subs=-attributes]
The address of the event system. The event system is the message queuing service. It is used as message broker for the microservice architecture.

a|`OCIS_EVENTS_CLUSTER` +
`STORAGE_USERS_EVENTS_CLUSTER` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ocis-cluster ++
a| [subs=-attributes]
The clusterID of the event system. The event system is the message queuing service. It is used as message broker for the microservice architecture. Mandatory when using NATS as event system.

a|`OCIS_INSECURE` +
`STORAGE_USERS_EVENTS_TLS_INSECURE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Whether to verify the server TLS certificates.

a|`OCIS_EVENTS_TLS_ROOT_CA_CERTIFICATE` +
`STORAGE_USERS_EVENTS_TLS_ROOT_CA_CERTIFICATE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The root CA certificate used to validate the server's TLS certificate. If provided STORAGE_USERS_EVENTS_TLS_INSECURE will be seen as false.

a|`OCIS_EVENTS_ENABLE_TLS` +
`STORAGE_USERS_EVENTS_ENABLE_TLS` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Enable TLS for the connection to the events broker. The events broker is the ocis service which receives and delivers events between the services.

a|`STORAGE_USERS_EVENTS_NUM_CONSUMERS` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++0 ++
a| [subs=-attributes]
The amount of concurrent event consumers to start. Event consumers are used for post-processing files. Multiple consumers increase parallelisation, but will also increase CPU and memory demands. The setting has no effect when the OCIS_ASYNC_UPLOADS is set to false. The default and minimum value is 1.

a|`OCIS_EVENTS_AUTH_USERNAME` +
`STORAGE_USERS_EVENTS_AUTH_USERNAME` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The username to authenticate with the events broker. The events broker is the ocis service which receives and delivers events between the services.

a|`OCIS_EVENTS_AUTH_PASSWORD` +
`STORAGE_USERS_EVENTS_AUTH_PASSWORD` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The password to authenticate with the events broker. The events broker is the ocis service which receives and delivers events between the services.

a|`OCIS_CACHE_STORE` +
`STORAGE_USERS_FILEMETADATA_CACHE_STORE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++memory ++
a| [subs=-attributes]
The type of the cache store. Supported values are: 'memory', 'redis-sentinel', 'nats-js-kv', 'noop'. See the text description for details.

a|`OCIS_CACHE_STORE_NODES` +
`STORAGE_USERS_FILEMETADATA_CACHE_STORE_NODES` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++[]string ++
a| [subs=-attributes]
++[127.0.0.1:9233] ++
a| [subs=-attributes]
A list of nodes to access the configured store. This has no effect when 'memory' or 'ocmem' stores are configured. Note that the behaviour how nodes are used is dependent on the library of the configured store. See the Environment Variable Types description for more details.

a|`OCIS_CACHE_DATABASE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++storage-users ++
a| [subs=-attributes]
The database name the configured store should use.

a|`OCIS_CACHE_TTL` +
`STORAGE_USERS_FILEMETADATA_CACHE_TTL` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++Duration ++
a| [subs=-attributes]
++24m0s ++
a| [subs=-attributes]
Default time to live for user info in the user info cache. Only applied when access tokens has no expiration. See the Environment Variable Types description for more details.

a|`OCIS_CACHE_SIZE` +
`STORAGE_USERS_FILEMETADATA_CACHE_SIZE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++0 ++
a| [subs=-attributes]
The maximum quantity of items in the user info cache. Only applies when store type 'ocmem' is configured. Defaults to 512 which is derived from the ocmem package though not exclicitly set as default.

a|`OCIS_CACHE_DISABLE_PERSISTENCE` +
`STORAGE_USERS_FILEMETADATA_CACHE_DISABLE_PERSISTENCE` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Disables persistence of the cache. Only applies when store type 'nats-js-kv' is configured. Defaults to false.

a|`OCIS_CACHE_AUTH_USERNAME` +
`STORAGE_USERS_FILEMETADATA_CACHE_AUTH_USERNAME` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The username to authenticate with the cache store. Only applies when store type 'nats-js-kv' is configured.

a|`OCIS_CACHE_AUTH_PASSWORD` +
`STORAGE_USERS_FILEMETADATA_CACHE_AUTH_PASSWORD` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The password to authenticate with the cache store. Only applies when store type 'nats-js-kv' is configured.

a|`OCIS_CACHE_STORE` +
`STORAGE_USERS_ID_CACHE_STORE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++memory ++
a| [subs=-attributes]
The type of the cache store. Supported values are: 'memory', 'redis-sentinel', 'nats-js-kv', 'noop'. See the text description for details.

a|`OCIS_CACHE_STORE_NODES` +
`STORAGE_USERS_ID_CACHE_STORE_NODES` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++[]string ++
a| [subs=-attributes]
++[127.0.0.1:9233] ++
a| [subs=-attributes]
A list of nodes to access the configured store. This has no effect when 'memory' or 'ocmem' stores are configured. Note that the behaviour how nodes are used is dependent on the library of the configured store. See the Environment Variable Types description for more details.

a|`OCIS_CACHE_DATABASE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ids-storage-users ++
a| [subs=-attributes]
The database name the configured store should use.

a|`OCIS_CACHE_TTL` +
`STORAGE_USERS_ID_CACHE_TTL` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++Duration ++
a| [subs=-attributes]
++24m0s ++
a| [subs=-attributes]
Default time to live for user info in the user info cache. Only applied when access tokens have no expiration. Defaults to 300s which is derived from the underlaying package though not explicitly set as default. See the Environment Variable Types description for more details.

a|`OCIS_CACHE_SIZE` +
`STORAGE_USERS_ID_CACHE_SIZE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++0 ++
a| [subs=-attributes]
The maximum quantity of items in the user info cache. Only applies when store type 'ocmem' is configured. Defaults to 512 which is derived from the ocmem package though not exclicitly set as default.

a|`OCIS_CACHE_DISABLE_PERSISTENCE` +
`STORAGE_USERS_ID_CACHE_DISABLE_PERSISTENCE` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Disables persistence of the cache. Only applies when store type 'nats-js-kv' is configured. Defaults to false.

a|`OCIS_CACHE_AUTH_USERNAME` +
`STORAGE_USERS_ID_CACHE_AUTH_USERNAME` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The username to authenticate with the cache store. Only applies when store type 'nats-js-kv' is configured.

a|`OCIS_CACHE_AUTH_PASSWORD` +
`STORAGE_USERS_ID_CACHE_AUTH_PASSWORD` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The password to authenticate with the cache store. Only applies when store type 'nats-js-kv' is configured.

a|`STORAGE_USERS_MOUNT_ID` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Mount ID of this storage.

a|`STORAGE_USERS_EXPOSE_DATA_SERVER` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Exposes the data server directly to users and bypasses the data gateway. Ensure that the data server address is reachable by users.

a|`STORAGE_USERS_READ_ONLY` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++bool ++
a| [subs=-attributes]
++false ++
a| [subs=-attributes]
Set this storage to be read-only.

a|`STORAGE_USERS_UPLOAD_EXPIRATION` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++int64 ++
a| [subs=-attributes]
++86400 ++
a| [subs=-attributes]
Duration in seconds after which uploads will expire. Note that when setting this to a low number, uploads could be cancelled before they are finished and return a 403 to the user.

a|`OCIS_ADMIN_USER_ID` +
`STORAGE_USERS_PURGE_TRASH_BIN_USER_ID` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
ID of the user who collects all necessary information for deletion. Consider that the UUID can be encoded in some LDAP deployment configurations like in .ldif files. These need to be decoded beforehand.

a|`STORAGE_USERS_PURGE_TRASH_BIN_PERSONAL_DELETE_BEFORE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++Duration ++
a| [subs=-attributes]
++720h0m0s ++
a| [subs=-attributes]
Specifies the period of time in which items that have been in the personal trash-bin for longer than this value should be deleted. A value of 0 means no automatic deletion. See the Environment Variable Types description for more details.

a|`STORAGE_USERS_PURGE_TRASH_BIN_PROJECT_DELETE_BEFORE` +

a| [subs=-attributes]
++pre5.0 ++
a| [subs=-attributes]
++Duration ++
a| [subs=-attributes]
++720h0m0s ++
a| [subs=-attributes]
Specifies the period of time in which items that have been in the project trash-bin for longer than this value should be deleted. A value of 0 means no automatic deletion. See the Environment Variable Types description for more details.

a|`OCIS_SERVICE_ACCOUNT_ID` +
`STORAGE_USERS_SERVICE_ACCOUNT_ID` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The ID of the service account the service should use. See the 'auth-service' service description for more details.

a|`OCIS_SERVICE_ACCOUNT_SECRET` +
`STORAGE_USERS_SERVICE_ACCOUNT_SECRET` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
The service account secret.

a|`OCIS_GATEWAY_GRPC_ADDR` +
`STORAGE_USERS_GATEWAY_GRPC_ADDR` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++127.0.0.1:9142 ++
a| [subs=-attributes]
The bind address of the gateway GRPC address.

a|`OCIS_MACHINE_AUTH_API_KEY` +
`STORAGE_USERS_MACHINE_AUTH_API_KEY` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++string ++
a| [subs=-attributes]
++ ++
a| [subs=-attributes]
Machine auth API key used to validate internal requests necessary for the access to resources from other services.

a|`STORAGE_USERS_CLI_MAX_ATTEMPTS_RENAME_FILE` +

a| [subs=-attributes]
++5.0 ++
a| [subs=-attributes]
++int ++
a| [subs=-attributes]
++0 ++
a| [subs=-attributes]
The maximum number of attempts to rename a file when a user restores a file to an existing destination with the same name. The minimum value is 100.
|===

